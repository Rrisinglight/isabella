## FPV Antenna Tracker — поворотное устройство с веб‑интерфейсом

Сервис на Python для слежения антенной (поворотным устройством) за источником сигнала на основе двухприёмной схемы (левый/правый RSSI). Включает:

- Веб‑интерфейс (управление, телеметрия, графики, карта)
- REST API для интеграций
- Автоскан углов по RSSI и автоматическое слежение
- Управление частотами VTX и видео‑скан частот
- Прокси WHEP (WebRTC Receive) для MediaMTX, чтобы избежать CORS


### Архитектура
- Backend: Flask (`antenna_tracker.py`) + поток трекинга
- Frontend: `templates/index.html`, `static/app.js`, `static/style.css`
- Серво: SCServo (SMS/SCS/STS) через `scservo_sdk`
- RSSI: АЦП ADS1115 (I2C, адрес по умолчанию `0x48`, каналы L=3, R=0) `ADS1x15-ADC`
- Видео: MediaMTX на `127.0.0.1:8889` (WHEP), плеер WebRTC в браузере


## Требования
- Raspberry Pi OS / Linux
- Python 3.9+ (рекомендуется)
- Включенный I2C (`raspi-config` → Interface Options → I2C)
- Подключённый серво‑контроллер по UART/USB (`/dev/ttyUSB0` по умолчанию)
- MediaMTX для видео (WHEP на порту 8889)

Python‑зависимости (минимум):
```
pip install flask flask-cors requests
```


## Подключение железа (суммарно)
- ADS1115 по I2C (шина 1): адрес по умолчанию `0x48` (можно изменить паяными перемычками)
- Каналы: левый RSSI → A3, правый RSSI → A0 (настраивается в коде)
- Серво: SCServo по `/dev/ttyUSB0`, 115200 бод, ID=1 (настраивается)


## Конфигурация
Изменяемые константы в начале `antenna_tracker.py`:
- `ENCODER_URL` — источник транспортного потока MPEG‑TS (резервный)
- `CAMERA_URL` — RTSP камеры (не обязателен для WebRTC‑пути)
- `WEB_PORT` — порт веб‑интерфейса (по умолчанию 5000)

Параметры серво в `ServoConfig`:
- `port`, `baudrate`, `id`
- Центр и лимиты: `center_pos`, `left_limit`, `right_limit`
- Скорости и ускорения: `default_speed/acc`, `auto_speed/acc`

Параметры АЦП в `ADCConfig`:
- `address`, `bus`, `left_channel`, `right_channel`


## Запуск
```
cd /home/pi/isabella
python3 antenna_tracker.py
```
Откройте браузер: `http://<ip-адрес-raspberry>:5000`

Веб‑интерфейс включает: видео, кнопки управления (Left/Home/Right, Auto, Scan, Calibrate), телеметрию, карту, панель VTX.


## Использование

### Режимы
- Ручной (Manual): кнопки Left/Right/Home двигают на фиксированный шаг (по умолчанию 3°)
- Скан (Scan): проход по диапазону углов, построение кривой RSSI и выбор оптимума
- Авто (Auto): периодические подстройки по разнице RSSI (мертвая зона, малые/средние/большие шаги)
- Калибровка: минимум (снятые антенны) → максимум (антенны + дрон в 1–2 м)

Кнопка Auto переключает авто/ручной режим. Кнопка Scan запускает/останавливает сканирование.


